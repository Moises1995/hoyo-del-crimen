<!-- this creates a google map on the page with the given lat/lng from -->
<!-- the component as the initial center of the map: -->
<ng-template #nocrimes>
  <p>No hay crimenes cercanos!!!</p>
</ng-template>

<div class="container-fluid">
  <div class="row">
    <form class="col-5 overflow-auto pl-5" style="height:650px">
      <p><strong>Información Importante</strong></p>
      <ul>
        <li>Tu ubicación puede tener un error de {{accuracy}}m</li>
      </ul>
      <mat-slide-toggle labelPosition='before' [checked]="swap"
      (input)="swap = $event.target.checked"><b>Cambiar Ubicación</b></mat-slide-toggle>
      <br/>
      <!-- COMPONENTE DE LONGITUD matInput -->
      <mat-form-field appearance="outline" class="mt-3">
        <mat-label>Longitude:</mat-label>
        <input matInput  [formControl]="formLong" [disableControl]="!swap" placeholder="Ex. -99.0888" [value]="longitude"
        (blur)="validateInputCoordinates(latitude, +$event.target.value)" id="inputLat" />
      </mat-form-field>
      <!-- COMPONENTE DE LATITUD matInput -->
      <mat-form-field appearance="outline" class="mx-3">
        <mat-label>Latitude:</mat-label>
        <input matInput [formControl]="formLat" [disableControl]="!swap" placeholder="Ex. 19.3804" [value]="latitude"
        (blur)="validateInputCoordinates(+$event.target.value, longitude)" id="inputLong"/>
      </mat-form-field>

      <p><b>Seleccionar Años:</b></p>
      <div class="custom-slider">
        <ng5-slider style="width:360px"
          [(value)]="minValue"
          [(highValue)]="maxValue"
          [options]="sliderOptions">
        </ng5-slider>
      </div>
      <!-- COMPONENTE DE MESES CON mat-select -->
      <p><b>Seleccionar Meses:</b></p>
      <mat-form-field appearance="outline">
        <mat-label>Meses:</mat-label>
        <mat-select [formControl]="months" (selectionChange)="mounthsSelecteds = $event.value; filterCrimes()" multiple>
          <mat-select-trigger>
            {{months.value ? months.value[0] : ''}}
            <span *ngIf="months.value?.length > 1" class="additional-selection">
              (+{{months.value.length - 1}} {{months.value?.length === 2 ? 'otro' : 'otros'}})
            </span>
            <!-- Opciones de meses -->
          </mat-select-trigger>
          <mat-option *ngFor="let month of monthsList" [value]="month">
            {{month}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- TABLA QUE CONTIENE LOS DIAS -->
      <p><b>Seleccionar Días:</b></p>
      <table class="table" style="width:360px">
        <tr>
          <th *ngFor="let daySelected of daysSelecteds"> {{ daySelected.day | slice:0:1}} </th>
        </tr>
        <tr>
          <td *ngFor="let daySelected of daysSelecteds">
          <mat-checkbox [(ngModel)]="daySelected.value" [name]="daySelected.day" (change)="filterCrimes()"></mat-checkbox>
        </tr>
      </table>
      <!-- COMPONENTE DE LAS 24 HORAS CON matInput -->
      <strong>Seleccionar Horas:</strong><br/>
      <span class="lead">Diferencia por </span>
      <mat-form-field appearance="standard" style="width:40px" class="mx-3">
        <mat-label>horas</mat-label>
        <input type="number" [value]="numHour" (input)="numHour = $event.target.value" min="1" max="24" matInput/>
      </mat-form-field>
      <button mat-raised-button (click)="nextHour()">Siguiente hora</button>
      <br/>
      <!-- COMPONENTE INICIO DE HORAS CON matInput -->
      <span class="lead">Inicio</span>
      <mat-form-field appearance="outline" style="width:100px" class="mx-3">
        <mat-label>hora:min</mat-label>
        <input type="time" [value]="time1" (blur)="time1 = $event.target.value; filterCrimes()" matInput/>
      </mat-form-field>
      <span class="lead">Fin</span>
      <!-- COMPONENTE FIN DE HORAS CON matInput -->
      <mat-form-field appearance="outline" style="width:100px" class="mx-3">
        <mat-label>hora:min</mat-label>
        <input type="time" [value]="time2" (blur)="time2 = $event.target.value; filterCrimes()" matInput/>
      </mat-form-field>

      <button mat-raised-button (click)="reset()">Reset</button>

      <br><strong>Seleccionar Clasificador:</strong><br/>
      <div>
        <button mat-raised-button (click)="classificationOption(1)" >Todos</button>
        <button mat-fab (click)="classificationOption(3)">
          <mat-icon>directions_run</mat-icon>
        </button>
        <button mat-fab (click)="classificationOption(2)">
          <mat-icon>directions_bus</mat-icon>
        </button>
      </div>

    <button mat-raised-button (click)="getRequest()" [disabled]="requestOption" >Actualizar datos</button>

    </form>

    <div class="col-lg-7">
      <span *ngFor="let crim of listCrimes">
        <button [matBadge]="crim.num" matBadgePosition="before" matBadgeColor="accent">
          <span class="iconCrime"></span>
          {{crim.name}}
        </button>
      </span>
      <agm-map *ngIf="latitude!=null || longitude!=null" [zoom]="zoom" [disableDoubleClickZoom]="true"
        [latitude]="latitude" [longitude]="longitude" (mapClick)="close_window($event)" (mapDblClick) ="current_location($event)" [mapTypeControl]='true' [fullscreenControl]='true'>
          <agm-marker
            [latitude]="latitude"
            [longitude]="longitude"
            [iconUrl]="{
              url: 'http://localhost:4200/assets/img/location.svg',
              scaledSize: {
                width: 28,
                height: 35
              } }"></agm-marker>

          <agm-circle
            [latitude]="latitude"
            [longitude]="longitude"
            [radius]="distance"
            [fillColor]="'red'"
            [circleDraggable]="false"
            [editable]="false"></agm-circle>

          <div *ngIf="crimesShown.length > 0 else nocrimes">
            <div *ngFor="let crim of crimesShown">
              <div *ngFor="let item of CrimesList; let i = index">
                <agm-marker *ngIf="crim.name == item"
                [latitude]="crim.lat"
                [longitude]="crim.long"
                [iconUrl]="{
                  url: IconsMap[i],
                  scaledSize: {
                    width: 23,
                    height: 30
                  } }"
                (markerClick)=select_marker(infoWindow)>
                <agm-info-window #infoWindow [disableAutoPan]="false">
                  <strong>{{crim.name}}</strong><br>
                  {{crim.date}} <br>
                  {{crim.time}}
                </agm-info-window>
                </agm-marker>
              </div>
            </div>
          </div>
      </agm-map>
    </div>
  </div>
</div>
