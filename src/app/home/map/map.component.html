<!-- this creates a google map on the page with the given lat/lng from -->
<!-- the component as the initial center of the map: -->
<ng-template #nocrimes>
  <p>No hay crimenes cercanos!!!</p>
</ng-template>

<div class="container">
  <div class="row">
    <form class="my-form1 col-lg-6">
      <p><strong>Información Importante</strong></p>
      <ul>
        <li>Tu ubicación puede tener un error de {{accuracy}}m</li>
        <li>Google Chrome puede generar problemas de ubicación</li>
      </ul>
      <mat-slide-toggle labelPosition='before' [checked]="swap"
      (input)="swap = $event.target.checked"><b>Cambiar Ubicación</b></mat-slide-toggle>
      <br/>
      <!-- COMPONENTE DE LONGITUD matInput -->
      <mat-form-field appearance="outline" class="mt-3">
        <mat-label>Longitude:</mat-label>
        <input matInput  [formControl]="formLong" [disableControl]="!swap" placeholder="Ex. -99.0888" [value]="longitude"
        (blur)="validateInputCoordinates(latitude, +$event.target.value)" id="inputLat" />
      </mat-form-field>
      <!-- COMPONENTE DE LATITUD matInput -->
      <mat-form-field appearance="outline" class="mx-3">
        <mat-label>Latitude:</mat-label>
        <input matInput [formControl]="formLat" [disableControl]="!swap" placeholder="Ex. 19.3804" [value]="latitude"
        (blur)="validateInputCoordinates(+$event.target.value, longitude)" id="inputLong"/>
      </mat-form-field>
      <!-- COMPONENTE DE AÑOS CON mat-select -->
      <mat-form-field appearance="outline" class="mr-3">
        <mat-label>Seleccionar Años</mat-label>
        <mat-select [formControl]="ages" [disableControl]="!swap" multiple>
          <mat-option *ngFor="let age of agesList" [value]="age">{{age}}</mat-option>
        </mat-select>
      </mat-form-field>
      <!-- COMPONENTE DE MESES CON mat-select -->
      <mat-form-field appearance="outline">
        <mat-label>Seleccionar Meses</mat-label>
        <mat-select [formControl]="months" (selectionChange)="mounthsSelecteds = $event.value; filterCrimes()" multiple>
          <mat-select-trigger>
            {{months.value ? months.value[0] : ''}}
            <span *ngIf="months.value?.length > 1" class="additional-selection">
              (+{{months.value.length - 1}} {{months.value?.length === 2 ? 'otro' : 'otros'}})
            </span>
            <!-- Opciones de meses -->
          </mat-select-trigger>
          <mat-option *ngFor="let month of monthsList" [value]="month">
            {{month}}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </form>
    <form class="my-form2 col-lg-6">
      <strong>Filtrar por hora</strong><br/>
      <span class="lead">Diferencia por </span>
      <!-- COMPONENTE DE LAS 24 HORAS CON matInput -->
      <mat-form-field appearance="standard" style="width:40px" class="mx-3">
        <mat-label>horas</mat-label>
        <input type="number" (click)="numHour = numHour + 1; funcionPrueba(numHour)" [value]="numHour" min="1" max="24" id='rangeHour' matInput/>
      </mat-form-field>
      <button mat-raised-button (click)="nextHour()">Siguiente hora</button>
      <br/>
      <!-- COMPONENTE INICIO DE HORAS CON matInput -->
      <span class="lead">Inicio</span>
      <mat-form-field appearance="outline" style="width:100px" class="mx-3">
        <mat-label>hora:min</mat-label>
        <input type="time" [value]="time1" (blur)="time1 = $event.target.value; filterCrimes()" matInput/>
      </mat-form-field>
      <span class="lead">Fin</span>
      <!-- COMPONENTE FIN DE HORAS CON matInput -->
      <mat-form-field appearance="outline" style="width:100px" class="mx-3">
        <mat-label>hora:min</mat-label>
        <input type="time" [value]="time2" (blur)="time2 = $event.target.value; filterCrimes()" matInput/>
      </mat-form-field>
      <!-- COMPONENTE POR DIAS -->
      <p><b>Filtrar por día</b></p>
      <table mat-table [dataSource]="daysList">
        <!-- Checbox column -->
        <ng-container matColumnDef="Select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="$event ? masterToggle():null; daysSelecteds = selection.selected; filterCrimes()"
            [checked] = "selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle (row): null; daysSelecteds = selection.selected; filterCrimes()"
            [checked]="selection.isSelected(row)"
            [id]="row">
            </mat-checkbox>
          </td>
        </ng-container>
        <!-- Day Column -->
        <ng-container matColumnDef="Day">
          <th mat-header-cell *matHeaderCellDef>Day</th>
          <td mat-cell *matCellDef="let day">
            {{day | slice: 0:1}}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="titles"></tr>
        <tr mat-row *matRowDef="let row; columns: titles;"></tr>
      </table>

      <button mat-button (click)="reset()">Reset</button>

    </form>
  </div>
</div>

<span>Crimenes entre: </span>
<br/>
  <form #form="ngForm">
    <button (click)="previousYear ()" *ngIf="query.start_date > 2015">-</button>
    <button (click)="previousYear()" *ngIf="query.start_date === 2015" disabled>-</button>
    <input type="text" [(ngModel)]="query.start_date" name="date1"/>
    <input type="text" [(ngModel)]="query.end_date" name="date2"/>
    <button (click)="nextYear()" *ngIf="query.end_date < 2019" >+</button>
    <button (click)="nextYear()" *ngIf="query.end_date === 2019" disabled>+</button>
    <br/>

    <br/><br/>
    <button (click)="getRequest()" [disabled]="requestOption" >Actualizar datos</button>
  </form>




<agm-map *ngIf="latitude!=null || longitude!=null" [zoom]="zoom" [disableDoubleClickZoom]="true"
  [latitude]="latitude" [longitude]="longitude" (mapClick)="close_window($event)" (mapDblClick) ="current_location($event)" [mapTypeControl]='true' [fullscreenControl]='true'>
    <agm-marker
      [latitude]="latitude"
      [longitude]="longitude"
      [iconUrl]="{
        url: 'http://localhost:4200/assets/img/location.svg',
        scaledSize: {
          width: 28,
          height: 35
        } }"></agm-marker>

    <agm-circle
      [latitude]="latitude"
      [longitude]="longitude"
      [radius]="distance"
      [fillColor]="'red'"
      [circleDraggable]="false"
      [editable]="false"></agm-circle>

    <div *ngIf="crimesShown.length > 0 else nocrimes">
      <div *ngFor="let crim of crimesShown">
        <div *ngFor="let item of CrimesList; let i = index">
          <agm-marker *ngIf="crim.name == item"
          [latitude]="crim.lat"
          [longitude]="crim.long"
          [iconUrl]="{
            url: IconsMap[i],
            scaledSize: {
              width: 23,
              height: 30
            } }"
          (markerClick)=select_marker(infoWindow)>
          <agm-info-window #infoWindow [disableAutoPan]="false">
            <strong>{{crim.name}}</strong><br>
            {{crim.date}} <br>
            {{crim.time}}
          </agm-info-window>


        </agm-marker>
          </div>
      </div>
    </div>
</agm-map>
